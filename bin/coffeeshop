#!/usr/bin/env ruby
require "bundler"
require "sinatra"
require_relative "../lib/coffeeshop"

configure do
  set :static, true
  set :public_folder, ENV["PWD"]
  set :root, ENV["PWD"]
  set :run, true
end

not_found do
  path = settings.root + env["PATH_INFO"]
  coffee_path = path.sub( /\.js$/, ".coffee" )

  if path =~ /\.js$/ && File.exists?( coffee_path )
    content_type "text/javascript"
    Coffeeshop.to_js( coffee_path )
  else
    if path =~ /\/$/
      index_path = "#{path}index.html"
    else
      index_path = "#{path}/index.html"
    end
    if File.exists?( index_path )
      File.read( index_path )
    end
  end
end
